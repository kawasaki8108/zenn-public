---
title: "WSL2-Ubuntu„ÅÆAnsible„Åã„ÇâEC2„Å´Êé•Á∂ö„ÉÜ„Çπ„Éà"
emoji: "üëè"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics: [Ansible,WSL,Ubuntu,AWS,EC2]
published: true
---
# ËÉåÊôØ
* Windows 11
* WSL2„ÅÆ„Éá„Ç£„Çπ„Éà„É™„Éì„É•„Éº„Ç∑„Éß„É≥ÔºöUbuntu-22.04
* „É≠„Éº„Ç´„É´„ÅÆUbuntu„ÄÅEC2ÔºàAmazon Linux2Ôºâ„Å´Ansible„ÇíÂãï„Åã„Åô„Åü„ÇÅ„ÅÆPython„ÅØÂ∞éÂÖ•Ê∏à„Åø
* Ubuntu„Å´AnsibleÂ∞éÂÖ•Ê∏à„ÅøÔºà[ÂÖ¨Âºè](https://docs.ansible.com/ansible/2.9_ja/installation_guide/intro_installation.html)ÂèÇÁÖßÔºâ
# ÁõÆÁöÑ
* „É≠„Éº„Ç´„É´Ubuntu„ÅÆAnsible„Åã„Çâ„Ç¢„Éâ„Éõ„ÉÉ„ÇØ„Ç≥„Éû„É≥„Éâ„ÅßEC2„Å∏„Ç≥„Éû„É≥„Éâ„Çí„Å™„Åí„Çâ„Çå„Çã„ÅãÁ¢∫Ë™ç„Åô„Çã
* ÊúÄÁµÇÁöÑ„Å´„ÅØplaybook„Å´„Çà„Çä„ÅÑ„Çç„ÅÑ„ÇçÂÆüË°å„Åó„Åü„ÅÑ„Åß„Åô„Åå„ÄÅ‰ªäÂõû„ÅØ‰∏ÄÊó¶„Åì„Åì„Åæ„Åß
# ÁµêË´ñ
‰ªäÂõû„ÅØÂçòÁ¥î„Åß„Åô„ÅÆ„Åß„ÄÅÁµêË´ñ„Å†„Åë„É°„É¢„Åó„Åæ„Åô„ÄÇÊú¨È°å„ÅØplaybook„Åß„Åô„ÅÆ„Åß„ÄÇ
### 1. `/etc/ansible/hosts`„Å´„Éõ„Çπ„ÉàÂêçÔºàEC2„ÅÆ„Éë„Éñ„É™„ÉÉ„ÇØIpv4Ôºâ„ÇíËøΩË®ò„Åó„Å¶‰øùÂ≠ò
„Å©„Åì„Å´Ë®òËºâ„Åó„Å¶„ÇÇ„ÅÑ„ÅÑ„Åß„Åô„Åå„ÄÅËá™ÂàÜ„ÅÆÂ†¥Âêà„ÅØ„ÄÅÊúÄ‰∏ãÈÉ®„Å´Ôºà‰æãÔºâ`35.78.170.81`„Å®ËøΩË®ò„Åó„Åæ„Åó„Åü„ÄÇ
### 2. „Ç¢„Éâ„Éõ„ÉÉ„ÇØ„Ç≥„Éû„É≥„ÉâÂÆüË°å
3„Å§Ë©¶„Åó„Å¶„Åø„Å¶„ÄÅÊÑèÂõ≥„Åó„ÅüËøîÁ≠î„Å†„Å£„Åü„ÅÆ„ÅßÂïèÈ°å„Å™„ÅèÊé•Á∂ö„ÉªÂÆüË°å„Åß„Åç„Åü„Åì„Å®„ÅåÁ¢∫Ë™ç„Åß„Åç„Åæ„Åó„Åü„ÄÇ
1„Å§ÁõÆÔºöping„Å´„Çà„ÇãÁñéÈÄöÁ¢∫Ë™ç
2„Å§ÁõÆ„ÄÅ3„Å§ÁõÆÔºö„Ç≥„Éû„É≥„ÉâÂÆüË°å
ÁßòÂØÜÈçµ„ÅÆÁΩÆ„ÅçÂ†¥ÊâÄ„Åå„Éõ„Çπ„ÉàOSÔºàC„Éâ„É©„Ç§„ÉñÔºâÂÅ¥„Å™„ÅÆ„Åß„ÄÅ`/mnt/c/`„Åã„Çâ„ÅÆ„Éá„Ç£„É¨„ÇØ„Éà„É™ÊåáÂÆö„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
```bash
$ sudo ansible EC2ÂÅ¥„ÅÆ„Éë„Éñ„É™„ÉÉ„ÇØIP -m ping -u ec2-user --private-key=/mnt/c/Users/„É¶„Éº„Ç∂„ÉºÂêç/„Ç≠„Éº„Éö„Ç¢Âêç.pem
[WARNING]: Platform linux on host EC2ÂÅ¥„ÅÆ„Éë„Éñ„É™„ÉÉ„ÇØIP is using the discovered Python interpreter at
/usr/bin/python3.7, but future installation of another Python interpreter could change the   
meaning of that path. See https://docs.ansible.com/ansible-
core/2.15/reference_appendices/interpreter_discovery.html for more information.
EC2ÂÅ¥„ÅÆ„Éë„Éñ„É™„ÉÉ„ÇØIP | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3.7"
    },
    "changed": false,
    "ping": "pong"
}

#`echo test`„Ç≥„Éû„É≥„Éâ„ÇíÊäï„Åí„Å¶`test`„Å®Ëøî„Å£„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô„ÄÇ
$ sudo ansible EC2ÂÅ¥„ÅÆ„Éë„Éñ„É™„ÉÉ„ÇØIP -a "echo test" --extra-vars "ansible_user=ec2-user ansible_ssh_pr
ivate_key_file=/mnt/c/Users/„É¶„Éº„Ç∂„ÉºÂêç/„Ç≠„Éº„Éö„Ç¢Âêç.pem"
Ôºà‰∏≠Áï•Ôºâ
EC2ÂÅ¥„ÅÆ„Éë„Éñ„É™„ÉÉ„ÇØIP | CHANGED | rc=0 >>
test

#`python3 --version`„Ç≥„Éû„É≥„Éâ„ÇíÊäï„Åí„Çã„Å®ver„ÅåËøî„Å£„Å¶„Åç„Åæ„Åô„ÄÇ
$ sudo ansible EC2ÂÅ¥„ÅÆ„Éë„Éñ„É™„ÉÉ„ÇØIP -a 'python3 --version' -u ec2-user --key-file=/mnt/c/Users/„É¶„Éº„Ç∂„ÉºÂêç/„Ç≠„Éº„Éö„Ç¢Âêç.pem
Ôºà‰∏≠Áï•Ôºâ
EC2ÂÅ¥„ÅÆ„Éë„Éñ„É™„ÉÉ„ÇØIP | CHANGED | rc=0 >>
Python 3.7.16
```
# ÂèÇËÄÉ
* „Ç¢„Éâ„Éõ„ÉÉ„ÇØ„Ç≥„Éû„É≥„Éâ„ÅÆ„ÇÑ„ÇäÊñπ

https://docs.ansible.com/ansible/latest/command_guide/intro_adhoc.html
* „Éõ„Çπ„Éà„Å∏„ÅÆÊé•Á∂öÊôÇ„ÅÆ„Ç™„Éó„Ç∑„Éß„É≥Ôºà`--extra-vars "ÔΩûÔΩûÔΩûÔΩû"`Ôºâ

https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html#intro-inventory
https://www.youtube.com/watch?v=LKSWE_endX8
https://docs.ansible.com/ansible/2.9/user_guide/modules.html#working-with-modules
https://oji-cloud.net/2022/07/25/post-7084/
https://qiita.com/yumenomatayume/items/552b1a4406e85df306c4

* „Ç¢„Éâ„Éõ„ÉÉ„ÇØ„Ç≥„Éû„É≥„Éâ„Ç®„É©„Éº„Åó„Åü„Å®„Åç„ÅÆansible„Åã„Çâ„ÅÆÊ°àÂÜÖ
:::details Â±ïÈñã
```
usage: ansible [-h] [--version] [-v] [-b] [--become-method BECOME_METHOD]
               [--become-user BECOME_USER]
               [-K | --become-password-file BECOME_PASSWORD_FILE] [-i INVENTORY]
               [--list-hosts] [-l SUBSET] [-P POLL_INTERVAL] [-B SECONDS] [-o] [-t TREE]     
               [--private-key PRIVATE_KEY_FILE] [-u REMOTE_USER] [-c CONNECTION]
               [-T TIMEOUT] [--ssh-common-args SSH_COMMON_ARGS]
               [--sftp-extra-args SFTP_EXTRA_ARGS] [--scp-extra-args SCP_EXTRA_ARGS]
               [--ssh-extra-args SSH_EXTRA_ARGS]
               [-k | --connection-password-file CONNECTION_PASSWORD_FILE] [-C] [-D]
               [-e EXTRA_VARS] [--vault-id VAULT_IDS]
               [--ask-vault-password | --vault-password-file VAULT_PASSWORD_FILES]
               [-f FORKS] [-M MODULE_PATH] [--playbook-dir BASEDIR]
               [--task-timeout TASK_TIMEOUT] [-a MODULE_ARGS] [-m MODULE_NAME]
               pattern

Define and run a single task 'playbook' against a set of hosts

positional arguments:
  pattern               host pattern

options:
  --ask-vault-password, --ask-vault-pass
                        ask for vault password
  --become-password-file BECOME_PASSWORD_FILE, --become-pass-file BECOME_PASSWORD_FILE       
                        Become password file
  --connection-password-file CONNECTION_PASSWORD_FILE, --conn-pass-file CONNECTION_PASSWORD_FILE
                        Connection password file
  --list-hosts          outputs a list of matching hosts; does not execute anything else     
  --playbook-dir BASEDIR
                        Since this tool does not use playbooks, use this as a substitute     
                        playbook directory. This sets the relative path for many features    
                        including roles/ group_vars/ etc.
  --task-timeout TASK_TIMEOUT
                        set task timeout limit in seconds, must be positive integer.
  --vault-id VAULT_IDS  the vault identity to use
  --vault-password-file VAULT_PASSWORD_FILES, --vault-pass-file VAULT_PASSWORD_FILES
                        vault password file
  --version             show program's version number, config file location, configured      
                        module search path, module location, executable location and exit    
  -B SECONDS, --background SECONDS
                        run asynchronously, failing after X seconds (default=N/A)
  -C, --check           don't make any changes; instead, try to predict some of the changes  
                        that may occur
  -D, --diff            when changing (small) files and templates, show the differences in   
                        those files; works great with --check
  -K, --ask-become-pass
                        ask for privilege escalation password
  -M MODULE_PATH, --module-path MODULE_PATH
                        prepend colon-separated path(s) to module library (default={{        
                        ANSIBLE_HOME ~
                        "/plugins/modules:/usr/share/ansible/plugins/modules" }})
  -P POLL_INTERVAL, --poll POLL_INTERVAL
                        set the poll interval if using -B (default=15)
  -a MODULE_ARGS, --args MODULE_ARGS
                        The action's options in space separated k=v format: -a 'opt1=val1    
                        opt2=val2' or a json string: -a '{"opt1": "val1", "opt2": "val2"}'   
  -e EXTRA_VARS, --extra-vars EXTRA_VARS
                        set additional variables as key=value or YAML/JSON, if filename      
                        prepend with @
  -f FORKS, --forks FORKS
                        specify number of parallel processes to use (default=5)
  -h, --help            show this help message and exit
  -i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY
                        specify inventory host path or comma separated host list.
                        --inventory-file is deprecated
  -k, --ask-pass        ask for connection password
  -l SUBSET, --limit SUBSET
                        further limit selected hosts to an additional pattern
  -m MODULE_NAME, --module-name MODULE_NAME
                        Name of the action to execute (default=command)
  -o, --one-line        condense output
  -t TREE, --tree TREE  log output to this directory
  -v, --verbose         Causes Ansible to print more debug messages. Adding multiple -v      
                        will increase the verbosity, the builtin plugins currently evaluate  
                        up to -vvvvvv. A reasonable level to start is -vvv, connection       
                        debugging might require -vvvv.

Privilege Escalation Options:
  control how and which user you become as on target hosts

  --become-method BECOME_METHOD
                        privilege escalation method to use (default=sudo), use `ansible-doc  
                        -t become -l` to list valid choices.
  --become-user BECOME_USER
                        run operations as this user (default=root)
  -b, --become          run operations with become (does not imply password prompting)       

Connection Options:
  control as whom and how to connect to hosts

  --private-key PRIVATE_KEY_FILE, --key-file PRIVATE_KEY_FILE
                        use this file to authenticate the connection
  --scp-extra-args SCP_EXTRA_ARGS
                        specify extra arguments to pass to scp only (e.g. -l)
  --sftp-extra-args SFTP_EXTRA_ARGS
                        specify extra arguments to pass to sftp only (e.g. -f, -l)
  --ssh-common-args SSH_COMMON_ARGS
                        specify common arguments to pass to sftp/scp/ssh (e.g.
                        ProxyCommand)
  --ssh-extra-args SSH_EXTRA_ARGS
                        specify extra arguments to pass to ssh only (e.g. -R)
  -T TIMEOUT, --timeout TIMEOUT
                        override the connection timeout in seconds (default=10)
  -c CONNECTION, --connection CONNECTION
                        connection type to use (default=smart)
  -u REMOTE_USER, --user REMOTE_USER
                        connect as this user (default=None)

Some actions do not make sense in Ad-Hoc (include, meta, etc)
```
:::

# ÊÑüÊÉ≥
* „Ç¢„Éâ„Éõ„ÉÉ„ÇØ„ÅßEC2„Å∏„ÅÆÊé•Á∂ö„Åå„Åß„Åç„Åæ„Åó„Åü„ÄÇ
* Ê¨°„ÅØplaybook„Çí‰Ωø„Å£„Å¶„ÅÑ„Åè„Å§„Åã„ÅÆ„Çø„Çπ„ÇØ„ÇíÂÆüË°å„Åó„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ
* ÊúÄÁµÇÁöÑ„Å´„ÄÅAnsible„ÅØCI/CD(CircleCI)„Éë„Ç§„Éó„É©„Ç§„É≥„ÅÆ1„Å§„Å®„Åó„Å¶„ÄÅÂÆüË°å„Åó„Åü„ÅÑ„Å®ÊÄù„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ
* „Åì„ÅÆÂ†¥Âêà„ÄÅCircleCI„ÅßÂëº„Å≥Âá∫„Åó„Åü„ÄÅCircleCI‰∏ä„ÅÆAnsible„ÅØÁßòÂØÜÈçµ„Çí„Å©„Åì„ÅßË™çË≠ò„Åô„Çã„ÅÆ„Åã„ÅÆÁñëÂïè„Åå„Åß„Åæ„Åó„Åü„ÄÇ
* [ÂÖ¨Âºè](https://circleci.com/docs/ja/add-ssh-key/)Ë¶ã„ÇãÊÑü„Åò„ÄÅ„É≠„Éº„Ç´„É´„Å´„Åä„ÅÑ„Å¶„ÇãÁßòÂØÜÈçµ„Åß„ÅØ„Å™„Åè„ÄÅCircleCI‰∏ä„Å´‰øùÁÆ°„Åô„Çã„ÅÆ„Åã„Å™„Å®ÊÄù„ÅÑ„Åæ„Åó„Åü„ÄÇ
